<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<!-- Meta, title, CSS, favicons, etc. -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../assets/css/admin/admin.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<link rel="stylesheet" href="../assets/css/base.css">
	<title>Web admin onlyfans </title>
	<!-- Bootstrap -->
	<link href="./vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
	<!-- Font Awesome -->
	<link href="./vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<!-- NProgress -->
	<link href="./vendors/nprogress/nprogress.css" rel="stylesheet">
	<!-- iCheck -->
	<link href="./vendors/iCheck/skins/flat/green.css" rel="stylesheet">
	<!-- bootstrap-wysiwyg -->
	<link href="./vendors/google-code-prettify/bin/prettify.min.css" rel="stylesheet">
	<!-- Select2 -->
	<link href="./vendors/select2/dist/css/select2.min.css" rel="stylesheet">
	<!-- Switchery -->
	<link href="./vendors/switchery/dist/switchery.min.css" rel="stylesheet">
	<!-- starrr -->
	<link href="./vendors/starrr/dist/starrr.css" rel="stylesheet">
	<!-- bootstrap-daterangepicker -->
	<link href="./vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">

	<!-- Custom Theme Style -->
	<link href="./build/css/custom.min.css" rel="stylesheet">
</head>

<body class="nav-md">
	<div class="container body">
		<div class="main_container">
			<div class="col-md-3 left_col">
				<div class="left_col scroll-view">
					<div class="navbar nav_title">
						<div class="imglogo" style="padding-left: 20px;">
							<a href="./main/index.html">
								<img src="./images/favicon.png" alt="Logo" style="width: 30px; height: auto;">
							</a>
						</div>
						<div style="padding-right:10px ; ">

							<a href="./main/index.html" class="site_title" style="padding-left: 0px;"> <span>Quản lí
									Onlyfans</span></a>
						</div>
					</div>

					<div class="clearfix"></div>

					<!-- menu profile quick info -->
					<div class="profile clearfix">
						<div class="profile_pic">
							<img src="./images/bed488561c6ab56101466edec05c5b16.jpg" alt="..."
								class="img-circle profile_img">
						</div>
						<div class="profile_info">
							<span>Xin chào ,</span>
							<h2>Admin</h2>
						</div>
					</div>


					<!-- /menu profile quick info -->

					<br />

					<!-- sidebar menu -->

					<div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
						<div class="menu_section">

							<ul class="nav side-menu">
								<li><a href="./main/index.html"><i class="fas fa-newspaper"></i> Bảng tin</a></li>
								<li><a><i class="fas fa-box"></i> Quản lí sản phẩm <span
											class="fa fa-chevron-down"></span></a>
									<ul class="nav child_menu">
										<li><a href="./sanpham.html">Tất cả sản phẩm </a></li>



									</ul>
								</li>
								<li><a><i class="fa-solid fa-cart-shopping"></i> Quản lí đơn hàng <span
											class="fa fa-chevron-down"></span></a>
									<ul class="nav child_menu">
										<li><a href="./main/tatcadonhang.html">Tất cả đơn hàng</a></li>
										<li><a href="./main/donhangchuaxuli.html">Chưa xử lí </a></li>
										<li><a href="./main/donhangdaxuli.html">Đã xử lí</a></li>

									</ul>
								</li>
								<li><a href="./main/qluser.html"><i class="fas fa-user"></i> Quản lí người dùng</a></li>

								<li><a href="./main/thongke.html" id="thong-ke-link"><i class="fas fa-chart-bar"></i> Thống
										kê</a></li>

								<li><a href="#"><i class="fas fa-comment"></i> Phản hồi</a></li>
							</ul>

						</div>
					</div>













					<!-- /sidebar menu -->

					<!-- /menu footer buttons -->
					<div class="sidebar-footer hidden-small">

						<a data-toggle="tooltip" data-placement="top" title="Logout" href="./main/login.html">
							<span class="glyphicon glyphicon-off" aria-hidden="true"></span>
						</a>
					</div>
					<!-- /menu footer buttons -->
				</div>
			</div>

			<!-- top navigation -->
			<div class="top_nav">
				<div class="nav_menu">
					<div class="nav toggle">
						<a id="menu_toggle"><i class="fa fa-bars"></i></a>
					</div>
					<nav class="nav navbar-nav">
						<ul class=" navbar-right">
							<li class="nav-item dropdown open" style="padding-left: 15px;">
								<a href="javascript:;" class="user-profile dropdown-toggle" aria-haspopup="true"
									id="navbarDropdown" data-toggle="dropdown" aria-expanded="false">
									<img src="../images/bed488561c6ab56101466edec05c5b16.jpg" alt="">Mạnh Dũng
								</a>
								<div class="dropdown-menu dropdown-usermenu pull-right"
									aria-labelledby="navbarDropdown">
									<a class="dropdown-item" href="javascript:;"> Profile</a>

									<a class="dropdown-item" href="./main/login.html"><i class="fa fa-sign-out pull-right"></i>
										Log Out</a>
								</div>
							</li>

							<li role="presentation" class="nav-item dropdown open">

								<ul class="dropdown-menu list-unstyled msg_list" role="menu"
									aria-labelledby="navbarDropdown1">
									<li class="nav-item">
										<a class="dropdown-item">
											<span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
											<span>
												<span>John Smith</span>
												<span class="time">3 mins ago</span>
											</span>
											<span class="message">
												Film festivals used to be do-or-die moments for movie makers. They were
												where...
											</span>
										</a>
									</li>
									<li class="nav-item">
										<a class="dropdown-item">
											<span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
											<span>
												<span>John Smith</span>
												<span class="time">3 mins ago</span>
											</span>
											<span class="message">
												Film festivals used to be do-or-die moments for movie makers. They were
												where...
											</span>
										</a>
									</li>
									<li class="nav-item">
										<a class="dropdown-item">
											<span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
											<span>
												<span>John Smith</span>
												<span class="time">3 mins ago</span>
											</span>
											<span class="message">
												Film festivals used to be do-or-die moments for movie makers. They were
												where...
											</span>
										</a>
									</li>
									<li class="nav-item">
										<a class="dropdown-item">
											<span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
											<span>
												<span>John Smith</span>
												<span class="time">3 mins ago</span>
											</span>
											<span class="message">
												Film festivals used to be do-or-die moments for movie makers. They were
												where...
											</span>
										</a>
									</li>
									<li class="nav-item">
										<div class="text-center">
											<a class="dropdown-item">
												<strong>See All Alerts</strong>
												<i class="fa fa-angle-right"></i>
											</a>
										</div>
									</li>
								</ul>
							</li>
						</ul>
					</nav>
				</div>
			</div>
			<!-- /top navigation -->

			<!-- page content -->
			<div class="right_col" role="main">
					<div class="product-admin">
						<div class="admin_input-products">
							<h2>Nhập Sản Phẩm</h2>
							<form id="productForm">
								<!-- Loại bỏ trường ID -->
								<label for="name">Tên Sản Phẩm:</label>
								<input type="text" id="name" name="name" required>
							
								<label for="description">Mô Tả:</label>
								<textarea id="description" name="description" required style="width:100%;"></textarea>
							
								<label for="price" class="spacejam">Giá:</label>
								<input type="number" id="price" name="price" required min="0">
							
								<label for="image">Hình Ảnh:</label>
								<input type="file" id="image" name="image" accept="image/*" required>
							
								<label for="brand">Hãng:</label>
								<input type="text" id="brand" name="brand" required>
							
								<label for="type">Loại:</label>
					<select id="type" name="type" required>
						<option value="Quạt lửng">Quạt Lửng</option>
						<option value="Quạt trần">Quạt Trần</option>
						<option value="Quạt hơi nước">Quạt Hơi Nước</option>
					</select>
					
							
								<label for="power" class="spacejam">Công Suất:</label>
								<input type="number" id="power" name="power" required min="0">
							
								<label for="speed">Tốc Độ:</label>
								<input type="number" id="speed" name="speed" required min="0">
							
								<label for="highlight">Nổi Bật:</label>
								<textarea id="highlight" name="highlight" required style="width:100%;"></textarea>
							
								<label for="origin" class="spacejam">Xuất Xứ:</label>
								<input type="text" id="origin" name="origin" required>
							
								<input type="submit" value="Thêm Sản Phẩm">
							</form>        
						</div>
					
						<div id="message"></div>
						<div id="notification"></div>
					
						<div class="admin_status-products">
							<div class="phanloai">
								<ul class="phanloai_sp">
									<li><a href="#" onclick="filterProducts('Quạt trần'); return false;">Quạt trần</a></li>
									<li class="li-space"><a href="#" onclick="filterProducts('Quạt lửng'); return false;">Quạt lửng</a></li>
									<li class="li-space"><a href="#" onclick="filterProducts('Quạt hơi nước'); return false;">Quạt hơi nước</a></li>
									<li class="li-space"><a href="#" onclick="filterProducts(''); return false;">Tất cả sản phẩm</a></li>
								</ul>
							</div>        
							<h3>Danh Sách Sản Phẩm</h3>
							<table id="productTable">
								<thead>
									<tr>
										<th style="width:30px;">ID</th>
										<th>Tên</th>
										<th style="max-width:130px;">Mô Tả</th>
										<th style="width:80px;">Giá</th>
										<th style="max-width:100px;">Hình Ảnh</th>
										<th style="width:100px;">Hãng</th>
										<th>Loại</th>
										<th>Hành Động</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
							<div class="pagination-admin">
								<button id="prevPage" style="display:none;">&#10094;</button>
								<span id="pageInfo"></span>
								<button id="nextPage" style="display:none;">&#10095;</button>
							</div>
						</div>
					
						<div id="editProductModal" class="modal">
							<div class="modal-content">
								<h4>Sửa Sản Phẩm</h4>
								<form id="editProductForm" action="update_product.php" method="POST" enctype="multipart/form-data">
									<div class="display_product">
										<div class="left-section">
											<label for="editId">ID Sản Phẩm:</label>
											<input type="text" id="editId" name="editId" readonly>
							
											<label for="editName">Tên Sản Phẩm:</label>
											<input type="text" id="editName" name="editName" required>
							
											<label for="editDescription">Mô Tả:</label>
											<textarea id="editDescription" name="editDescription" required></textarea>
							
											<label for="editPrice">Giá:</label>
											<input type="number" id="editPrice" name="editPrice" required min="0">
							
											<label for="editImage">Hình Ảnh:</label>
											<input type="file" id="editImage" name="editImage" accept="image/*">
										</div>
							
										<div class="right-section">
											<label for="editBrand">Thương Hiệu:</label>
											<input type="text" id="editBrand" name="editBrand">
							
											<label for="editType">Loại:</label>
											<select id="editType" name="editType">
												<option value="Quạt lửng">Quạt Lửng</option>
												<option value="Quạt trần">Quạt Trần</option>
												<option value="Quạt hơi nước">Quạt Hơi Nước</option>
											</select>
											
							
											<label for="editPower">Công Suất:</label>
											<input type="number" id="editPower" name="editPower" min="1">
							
											<label for="editSpeed">Tốc Độ:</label>
											<input type="number" id="editSpeed" name="editSpeed" min="1">
								
											<label for="editHighlight">Nổi Bật:</label>
											<textarea id="editHighlight" name="editHighlight"></textarea>
								
											<label for="editOrigin">Xuất Xứ:</label>
											<input type="text" id="editOrigin" name="editOrigin">
										</div>
									</div>
						
									<div class="button-distance">
										<input type="submit" value="Cập Nhật">
										<button type="button" onclick="closeEditModal()" class="huy-edit">Hủy</button>
									</div>
								</form>
							</div>
						</div>
					
						<div id="confirmDeleteModal" class="modal">
							<div class="modal-content" style="text-align: center;">
								<h4>Bạn có chắc chắn muốn xóa sản phẩm này?</h4>
								<button id="confirmDeleteBtn">Xóa</button>
								<button id="cancelDeleteBtn">Hủy</button>
							</div>
						</div>
				
						<div id="toast-admin" class="toast-admin">Sản phẩm đã được thêm thành công!</div>
					</div>
			</div>
			<!-- /page content -->

			<!-- footer content -->
			<footer>
				<div class="pull-right">
					<a href="#">From onlyfans with love</a> 
				</div>
				<div class="clearfix"></div>
			</footer>
			<!-- /footer content -->
		</div>
	</div>

	<!-- jQuery -->
	<script src="./vendors/jquery/dist/jquery.min.js"></script>
	<!-- Bootstrap -->
	<script src="./vendors/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
	<!-- FastClick -->
	<script src="./vendors/fastclick/lib/fastclick.js"></script>
	<!-- NProgress -->
	<script src="./vendors/nprogress/nprogress.js"></script>
	<!-- bootstrap-progressbar -->
	<script src="./vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
	<!-- iCheck -->
	<script src="./vendors/iCheck/icheck.min.js"></script>
	<!-- bootstrap-daterangepicker -->
	<script src="./vendors/moment/min/moment.min.js"></script>
	<script src="./vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
	<!-- bootstrap-wysiwyg -->
	<script src="./vendors/bootstrap-wysiwyg/js/bootstrap-wysiwyg.min.js"></script>
	<script src="./vendors/jquery.hotkeys/jquery.hotkeys.js"></script>
	<script src="./vendors/google-code-prettify/src/prettify.js"></script>
	<!-- jQuery Tags Input -->
	<script src="./vendors/jquery.tagsinput/src/jquery.tagsinput.js"></script>
	<!-- Switchery -->
	<script src="./vendors/switchery/dist/switchery.min.js"></script>
	<!-- Select2 -->
	<script src="./vendors/select2/dist/js/select2.full.min.js"></script>
	<!-- Parsley -->
	<script src="./vendors/parsleyjs/dist/parsley.min.js"></script>
	<!-- Autosize -->
	<script src="./vendors/autosize/dist/autosize.min.js"></script>
	<!-- jQuery autocomplete -->
	<script src="./vendors/devbridge-autocomplete/dist/jquery.autocomplete.min.js"></script>
	<!-- starrr -->
	<script src="./vendors/starrr/dist/starrr.js"></script>
	<!-- Custom Theme Scripts -->
	<script src="./build/js/custom.min.js"></script>
	<script>
        let currentPage = 1;
        const productsPerPage = 5;
        let products = [];
        let productIdToDelete = null;
        let filteredProducts = products;
        document.getElementById('productForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);

            fetch('../dulieu/insert_product.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(data => {
                document.getElementById('message').innerHTML = data;
                this.reset();
                loadProducts();
                showToast('Sản phẩm đã được thêm thành công!','success');
            })
            .catch(error => console.error('Error:', error));
        });

        function loadProducts() {
            fetch('../dulieu/data.js')
                .then(response => response.text())
                .then(data => {
                    products = JSON.parse(data.replace('var products = ', '').slice(0, -1));
                    filteredProducts = products;
                    displayProducts();
                })
                .catch(error => console.error('Error loading products:', error));
        }

        function displayProducts() {
    const tbody = document.querySelector('#productTable tbody');
    tbody.innerHTML = '';

    // Sử dụng filteredProducts thay vì products
    const startIndex = (currentPage - 1) * productsPerPage;
    const endIndex = Math.min(startIndex + productsPerPage, filteredProducts.length);
    const paginatedProducts = filteredProducts.slice(startIndex, endIndex);

    paginatedProducts.forEach(product => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td style="font-size:15px";>${product.id}</td>
            <td class="name" style="font-size:15px";>${product.name}</td>
            <td class="description" style="font-size:15px";>${product.description}</td>
            <td style="font-size:15px";>${product.price}</td>
            <td><img src="/project-web1sgu/assets/Images/products/${product.image}" alt="${product.name}" width="100"></td>
            <td style="font-size:15px";>${product.brand}</td>
            <td style="font-size:15px";>${product.type}</td>
            <td>
                <button class="edit-btn" onclick="editProduct('${product.id}')">Sửa</button>
                <button class="delete-btn" onclick="deleteProduct('${product.id}')">Xóa</button>
            </td>
        `;
        tbody.appendChild(row);
    });

    updatePagination();
}


        function updatePagination() {
            const totalPages = Math.ceil(products.length / productsPerPage);
            document.getElementById('pageInfo').textContent = `Trang ${currentPage} / ${totalPages}`;
            document.getElementById('prevPage').style.display = currentPage > 1 ? 'inline' : 'none';
            document.getElementById('nextPage').style.display = currentPage < totalPages ? 'inline' : 'none';
        }

        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayProducts();
            }
        });

        document.getElementById('nextPage').addEventListener('click', () => {
            const totalPages = Math.ceil(products.length / productsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayProducts();
            }
        });

        function deleteProduct(productId) {
            productIdToDelete = productId;
            document.getElementById('confirmDeleteModal').style.display = 'flex';
        }

        document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
            if (productIdToDelete) {
                fetch('../dulieu/delete_product.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id: productIdToDelete })
                })
                .then(response => response.text())
                .then(data => {
                    showToast('Sản phẩm đã được xóa thành công!','error');
                    loadProducts();
                    closeModal();
                })
                .catch(error => console.error('Error:', error));
            }
        });

        document.getElementById('cancelDeleteBtn').addEventListener('click', closeModal);

        function closeModal() {
            document.getElementById('confirmDeleteModal').style.display = 'none';
            productIdToDelete = null;
        }

        // function showToast(message) {
        //     const toast = document.getElementById('toast-admin');
        //     toast.textContent = message;
        //     toast.classList.add('show');
        //     setTimeout(() => {
        //         toast.classList.remove('show');
        //     }, 3000);
        // }
		function showToast(message, type) {
    const toast = document.getElementById('toast-admin');

    // Xóa tất cả các lớp trạng thái trước đó
    toast.classList.remove('toast-success', 'toast-error', 'toast-info', 'show');

    // Thêm nội dung thông báo
    toast.textContent = message;

    // Thêm lớp trạng thái phù hợp
    if (type === 'success') {
        toast.classList.add('toast-success');
    } else if (type === 'error') {
        toast.classList.add('toast-error');
    } else if (type === 'info') {
        toast.classList.add('toast-info');
    }

    // Hiển thị thông báo
    toast.classList.add('show');

    // Ẩn thông báo sau 3 giây
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}


        window.onload = loadProducts;

        function editProduct(productId) {
    fetch('../dulieu/data.js')
        .then(response => response.text())
        .then(data => {
            const products = JSON.parse(data.replace('var products = ', '').slice(0, -1));
            const product = products.find(p => p.id == productId);

            if (product) {
                const editFields = [
                    { field: 'editId', value: product.id },
                    { field: 'editName', value: product.name },
                    { field: 'editDescription', value: product.description },
                    { field: 'editPrice', value: product.price.toString().replace(/\./g, '').replace(/,/g, '.') }, // Chuyển đổi giá
                    { field: 'editBrand', value: product.brand },
                    { field: 'editType', value: product.type },
                    { field: 'editPower', value: product.power },
                    { field: 'editSpeed', value: product.speed },
                    { field: 'editHighlight', value: product.highlight },
                    { field: 'editOrigin', value: product.origin }
                ];

                editFields.forEach(({ field, value }) => {
                    const element = document.getElementById(field);
                    if (element) {
                        element.value = value;
                    }
                });

                document.getElementById('editProductModal').style.display = 'flex';
            }
        })
        .catch(error => console.error('Error:', error));
}

document.getElementById('editProductForm').addEventListener('submit', function(event) {
    event.preventDefault();
    const formData = new FormData(this);

    // Debug: Kiểm tra nội dung của formData
    for (let pair of formData.entries()) {
        console.log(pair[0] + ', ' + pair[1]);
    }

    fetch('../dulieu/update_product.php', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok: ' + response.statusText);
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            showToast(data.success);
            loadProducts();  // Đảm bảo loadProducts() được định nghĩa để tải lại sản phẩm
            closeEditModal();
        } else {
            showToast(data.error || 'Đã xảy ra lỗi khi cập nhật sản phẩm.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Đã xảy ra lỗi khi cập nhật sản phẩm.');
    });
});

function closeEditModal() {
    document.getElementById('editProductModal').style.display = 'none';
}

function filterProducts(selectedType = '') {
    filteredProducts = products.filter(product => {
        return selectedType ? product.type === selectedType : true; // Lọc theo loại nếu có, nếu không thì lấy tất cả sản phẩm
    });

    currentPage = 1; // Reset về trang đầu khi lọc
    displayProducts(); // Hiển thị sản phẩm đã lọc
}


    </script>
</body>

</html>